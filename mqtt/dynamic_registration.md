# Dynamic registration  

## Connection Parameters  

Parameter name | Parameter description
---- | ----
 Access domain name | Test environment: [testmqtt.protco.in](mqtt:\\testmqtt.protco.in) Formal environment: [mqtt.protco.in](mqtt:\\mqtt.protco.in)
 mqttClientId | format: `register_${pid}_${unique}`
 username | format: `${pid}\|signMethod=${signMethod},ts=${ts}`
 password | hmacSha256(content, secret) content: `uuid=${pid},ts=${ts}` secret: Take the secret dynamically registered by the product
 ts | timestamp (seconds)
signMethod | signature algorithm, hmacSha1, hmacSha256 can be selected according to hardware capabilities.
unique | The unique identifier of the device. If not, the firmware code is generated to ensure uniqueness under the product. It is agreed that once the device is determined, the value will not change. It is recommended to use a random UUID. unique cannot contain underscores "_"

## Device initiated dynamic registration  

Subscribe Topic(Cloud to device): `register/v2/${pid}/${unique}/register_response`  
Publish Topic(Device to cloud): `register/v2/${pid}/${unique}/register`  

```JSON
//Report data structure
{
    "id":"45lkj3551234001",//Message ID
    "ts":1626197189,//Timestamp (seconds)
    "code":"register",//Event code
    "ack":1, //0: No reply required; 1: Reply required
    "data":{
        "barcode":"112233443234", //Optional; if this value is passed, the barcode pre-generated by the triplet will be overwritten
        "replacePid":"112233443234", //Optional; if this value is passed, the registered triplet pid will change
        "secret":"xxxx" //Optional; must be passed when replacePid is not empty, pass the secret of replacePid
    }
}

//Cloud reply (no reply when ack=0)
{
    "res":0, //Status code 0 represents success, others represent failure; see status code definition
    "msg":"success", //Result description
    "id":"45lkj3551234001", //Message ID (consistent with the reported message ID)
    "ts":1626197189, //Timestamp (seconds)
    "code":"register", //Event code (consistent with the reported event code)
    "data":{
        "pid":"xxxxxx",
        "uuid":"rn01xxxxxxx",
        "secret":"",
        "mac":""
    }
}
```
